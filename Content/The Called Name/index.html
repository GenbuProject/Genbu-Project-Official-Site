<!DocType HTML>

<HTML>
	<Head>
		<Meta Charset = "UTF-8">
		<Title>Genbu Project Official Site == The Called Name</Title>
		
		<Script Src = "https://genbuproject.github.io/RPG-Helper/Release/RPG Helper Release 1.3.js"></Script>
		<Link Rel = "StyleSheet" HREF = "https://genbuproject.github.io/RPG-Helper/Release/RPG Helper Release 1.3.css">
		
		<Script Src = "Script/JsDecoder.js"></Script>
		<Script Src = "Script/JsColorizer.js"></Script>
		<Script Src = "Script/The Called Name.js"></Script>
		
		<Script Src = "https://code.jquery.com/jquery-1.12.2.js"></Script>
		
		<Script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			
			ga('create', 'UA-82835508-1', 'auto');
			ga('require', 'linkid', 'linkid.js');
			ga('send', 'pageview');
		</Script>
		
		<Script Type = "Text/JavaScript">
			function KeySet() {
				document.getElementById("Code").addEventListener("keydown", function (Event) {
					switch (Event.keyCode) {
						case 9:
			        		Event.preventDefault();
			        		
			        		var Pos = document.getElementById("Code").selectionStart;
			        		
			       			document.getElementById("Code").value = document.getElementById("Code").value.substr(0, document.getElementById("Code").selectionStart) + "\t" + document.getElementById("Code").value.substr(document.getElementById("Code").selectionStart, document.getElementById("Code").value.length);
			        		document.getElementById("Code").setSelectionRange(Pos + 1, Pos + 1);
			        		
			        		break;
		    		}
				});
			}
			
			function Formater() {
				var Code = document.getElementById("Code").value;
				
				var Decoder = new JsDecoder();
					Decoder.s = Code;
					Code = Decoder.decode();
					
				var Colorizer = new JsColorizer();
					Colorizer.s = Code;
					Code = Colorizer.colorize();
					
				document.getElementById("FormatedCode").innerHTML = Code;
				
				if (document.getElementById("FormatedCode").innerHTML == "") {
					document.getElementById("FormatedCode").style.display = "None";
				} else {
					document.getElementById("FormatedCode").style.display = "Block";
				}
			}
			
			Date.prototype.getToday = function (SplitWord) {
				var Day = new Date().toLocaleDateString().split("/");
				var Dates = [Day[0], Day[1], Day[2]];
				
				if (Dates[1].length == 1) Dates[1] = "0" + Day[1];
				if (Dates[2].length == 1) Dates[2] = "0" + Day[2];
				
				return Dates[0] + SplitWord + Dates[1] + SplitWord + Dates[2];
			}
		</Script>
		
		<Script Name = "Calc-Object" Type = "Text/JavaScript">
			var Calc = Object.create(null);
				Calc.TypeID = {
					Character: 0x0001,
					Monster: 0x0002
				}
				
				Calc.GetGenericATKDamage = function (TypeID, CharacterOrMonsterID) {
					if (TypeID === Calc.TypeID.Character) return Resource.UserData.Character[CharacterOrMonsterID].ATK + Math.floor(Math.random() * 5 + 1);
					if (TypeID === Calc.TypeID.Monster) return Resource.SystemData.Monster[CharacterOrMonsterID].ATK + Math.floor(Math.random() * 5 + 1);
				}
				
				Calc.GetGenericMAGDamage = function (TypeID, CharacterOrMonsterID, UsingMagicID) {
					if (TypeID === Calc.TypeID.Character) return (Resource.UserData.Character[CharacterOrMonsterID].MAG + Math.floor(Math.random() * 5 + 1)) * Resource.SystemData.Magic[UsingMagicID].GenericDamage;
					if (TypeID === Calc.TypeID.Monster) return (Resource.SystemData.Monster[CharacterOrMonsterID].MAG + Math.floor(Math.random() * 5 + 1)) * Resource.SystemData.Magic[UsingMagicID].GenericDamage;
				}
				
				Calc.GetFinalATKDamage = function (AttackerData, VictimData) {
					if (AttackerData[0] === Calc.TypeID.Character) {
						var Attacker = Resource.UserData.Character[AttackerData[1]];
						
						if (VictimData[0] === Calc.TypeID.Character) {
							var Victim = Resource.UserData.Character[VictimData[1]];
						} else if (VictimData[0] === Calc.TypeID.Monster) {
							var Victim = Resource.SystemData.Monster[VictimData[1]];
						}
					} else if (AttackerData[0] === Calc.TypeID.Monster) {
						var Attacker = Resource.SystemData.Monster[AttackerData[1]];
					}
					
					if (Attacker.ATK > Victim.DEF) {
						return Math.round(Calc.GetGenericATKDamage(AttackerData[0], AttackerData[1]) * (1 + 0.1 * (Attacker.ATK - Victim.DEF)));
					} else if (Attacker.ATK < Victim.DEF) {
						return Math.round(Calc.GetGenericATKDamage(AttackerData[0], AttackerData[1]) * (1 - 0.01 * (Victim.DEF - Attacker.ATK)));
					} else {
						return Math.round(Calc.GetGenericATKDamage(AttackerData[0], AttackerData[1]));
					}
				}
				
				Calc.GetFinalMAGDamage = function (AttackerData, VictimData, UsingMagicID) {
					if (AttackerData[0] === Calc.TypeID.Character) {
						var Attacker = Resource.UserData.Character[AttackerData[1]];
						
						if (VictimData[0] === Calc.TypeID.Character) {
							var Victim = Resource.UserData.Character[VictimData[1]];
						} else if (VictimData[0] === Calc.TypeID.Monster) {
							var Victim = Resource.SystemData.Monster[VictimData[1]];
						}
					} else if (AttackerData[0] === Calc.TypeID.Monster) {
						var Attacker = Resource.SystemData.Monster[AttackerData[1]];
					}
					
					if (Attacker.MAG > Victim.DEF) {
						return Math.round(Calc.GetGenericMAGDamage(AttackerData[0], AttackerData[1], UsingMagicID) * (1 + 0.1 * (Attacker.MAG - Victim.DEF)));
					} else if (Attacker.MAG < Victim.DEF) {
						return Math.round(Calc.GetGenericMAGDamage(AttackerData[0], AttackerData[1], UsingMagicID) * (1 - 0.01 * (Victim.DEF - Attacker.MAG)));
					} else {
						return Math.round(Calc.GetGenericMAGDamage(AttackerData[0], AttackerData[1], UsingMagicID));
					}
				}
				
			var Fight = {
				Init: function (GroupID, Menu, R) {
					var MonsterParty = [];
					var MonsterCvs = [];
					
					FightMemory = [];
					
					for (var i = 0; i < Resource.SystemData.Group[GroupID].length; i++) {
						MonsterParty[i] = $.extend(true, {}, Resource.SystemData.Monster[Resource.SystemData.Group[GroupID][i]]);
						
						MonsterCvs[i] = document.createElement("Canvas");
							MonsterCvs[i].id = "Monster" + i;
							MonsterCvs[i].style.position = "Absolute";
							
						document.getElementById("RPGHelper-Main").appendChild(MonsterCvs[i]);
						
						FightMemory[i] = MonsterParty[i];
						
						var Graphic = new Image();
							Graphic.src = "MonsterGraphic/" + MonsterParty[i].MonsterGraphic;
							
							Graphic.onload = (function (i) {
								return function () {
									MonsterCvs[i].width = document.getElementById("RPGHelper-Main").style.width.split("px")[0] / 5;
									MonsterCvs[i].height = document.getElementById("RPGHelper-Main").style.height.split("px")[0] / 5;
									MonsterCvs[i].style.left = (document.getElementById("RPGHelper-Main").style.width.split("px")[0] / 5) * i + "px";
									
									MonsterCvs[i].getContext("2d").drawImage(Graphic, 0, 0, Graphic.width, Graphic.height, 0, 0, document.getElementById("RPGHelper-Main").style.width.split("px")[0] / 5, document.getElementById("RPGHelper-Main").style.height.split("px")[0] / 5);
								}
							})(i);
					}
					
					var BattlePane = Menu.MenuPanel(["05", "3^"]);
						Menu.MenuItem(BattlePane, ["00", "31"], R.COLOR.WHITE, "攻撃", function () {
							var SelectPane = Menu.MenuPanel(["35", "^^"]);
							
							for (var i = 0; i < MonsterParty.length; i++) {
								var MonsterSelect = Menu.MenuItem(SelectPane, ["0" + i.toString(), "7" + (i + 1).toString()], R.COLOR.WHITE, MonsterParty[i].Name, (function (i) {
									return function () {
										FightMemory[i].HP -= Calc.GetFinalATKDamage([Calc.TypeID.Character, 0], [Calc.TypeID.Monster, Resource.SystemData.Group[GroupID][i]]);
									}
								})(i));
								
								MonsterSelect.id = "MonsterSelect" + i;
								
								MonsterSelect.onmouseover = (function (i) {
									return function () {
										MonsterCvs[i].className = "TheCalledName-MonsterArea";
									}
								})(i);
								
								MonsterSelect.onmouseout = (function (i) {
									return function () {
										MonsterCvs[i].className = "";
									}
								})(i);
							}
						});
				}
			}
		</Script>
		
		<Style>
			.TheCalledName-MonsterArea {
				Border: 5px Groove LightBlue;
				Border-Radius: 5px 5px 5px 5px;
			}
		</Style>
	</Head>
	
	<Body Style = 'Color: #EEE; Font: 14px/2 "メイリオ", Meiryo, Osaka; BackGround: URL("Image/Back.jpg");' OnLoad = "Main(); KeySet();">
		<Div ID = "RPGHelper-Main" Width = "512" Height = "512"></Div>
		
		<TextArea ID = "Code" Wrap = "Off" Style = "Width: 100%; Height: 250px" OnKeyDown = "Formater();" OnKeyPress = "Formater();" OnKeyUp = "Formater();"></TextArea>
		<Pre ID = "FormatedCode" Style = "Color: MenuText; BackGround: Menu; Border: Thin Solid OrangeRed; Border-Radius: 5px; Line-Height: 1.5; Display: None;"></Pre>
		<Button OnClick = 'eval(document.getElementById("Code").value);'>コード実行</Button>
	</Body>
</HTML>
